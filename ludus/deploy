=========================================
$ !!DO NOT DEPLOY THIS TO PRODUCTION!!  $
$  THIS IS DEPLOYMENT FOR DEVELOPMENT   $
$            PURPOSE ONLY               $
=========================================

-------------------------------------
Modification of the client script:
-------------------------------------
1) modify the source code on gitlab (it has it's own branch jbodnar/ludus in the gitlab repository of ucollect)
   - the source code is in directory ucollect/src/plugins/sendline
   -  it's job is to take the last line of a file and send it to server
2) Deploy client


-------------------------------------
Modification of the server script:
-------------------------------------
1) modify the source code on gitlab (it has it's own branch jbodnar/ludus in the gitlab repository of ucollect)
   - the server script is in file /src/master/sendline_plugin.py
     - this script parses a received line and stores it to database
   - the database init is in ./ucollect/src/plugins/sendline/ludus_initdb


2) Deploy server

-------------------------------------
Deployment of client:
-------------------------------------
1) go to build_package_pro_turris/ and run ./build_repo.sh all
2) installation packages are in
./.omnia-sdk/bin/mvebu-musl/packages/base/ucollect-sendline_1_mvebu.ipk
./.turris-sdk/bin/mpc85xx/packages/base/ucollect-sendline_1_mpc85xx.ipk

3) upload the corresponding file to router. (Be careful to upload turris package to turris router and omnia package to omnia router)
4) 
opkg update;
opkg install ucollect-prog;
opkg install ____PACKAGE____.ipk;
5) add to /usr/share/ucollect/configs/00-main.cfg
config plugin
    option libname 'libplugin_ucollect_sendline_1.so'


[steps 6-8 are only done when deploying for testing purposes with use of a testing server. They will not be in production release.]

6) change /usr/share/ucollect/configs/00-main.cfg
change "config uplink" to:

config uplink
        option name collectserver
        option service 5679
        option cert "/etc/ssl/ludus-ucollect-server.cert"


7) upload certificate to router
   upload ./cert.cert to location /etc/ssl/ludus-ucollect-server.cert 


8) add a new line to /etc/hosts
192.168.1.110 collectserver
//this should be the ip address on which you run the ucollect server.

9) touch /tmp/ludus_output
   This is the file where you should write the data you want to send.
   It's last line is sent periodically once per minute.
10) /etc/init.d/ucollect restart


--------------------------------------
Virtualbox machine deployment:
--------------------------------------
1) import the virtual machine into your virtualbox (created with Virtualbox 4.3.36_Ubuntu)
2) start the virtual machine
2) set network settings to network bridge so that the virtual machine can be accessed from your LAN
3) login:
login:    user
password: user

login:    root
password: root

4) run ifconfig (requires root)
   to see what is the current ip of the machine so that you can write it into /etc/hosts of your routers
5) run run_ucollect.sh from terminal
   after some time the ucollect instances in routers will connect.
   if you want them to connect sooner, log in via ssh and run /etc/init.d/ucollect restart
   you can see the output of ucollect, including the received lines in the terminal.
6) you may see the data inside the database when you run open_postgres_shell.sh
   it may take some time before ucollect flushes it's cache and stores the received data into database

7) the database tables can be listed by typing
\d
into the console (the listing is closed by pressing q)

ludus tables begin with prefix ludus_
the rest of their name should be in correspondence with the original name in the DB scheme.


-------------------------------------
Deployment of server:   [DOES IT WORK LIKE THIS NOW?]
-------------------------------------

1) download the latest version of branch jbodnar/ludus from the ucollect repository
2) copy ./cert.cert ./key.pem to ucollect/master/

3) change ucollect/master/collect-master.conf:

cert = cert.cert
key  = key.pem
ca   = cert.cert


4) BUILD AND INSTALL NEWCOLLECT
5) INSTALL LUDUS DATABASE

psql$ create database turris; 

bash$ ./ucollect/src/plugins/sendline/ludus_initdb

6) run server

cd ./ucollect/src/master/
python authenticator/authenticator_allow_all.py authenticator/authenticator.conf

cd ./ucollect/src/master/
python collect_master.py collect-master.conf